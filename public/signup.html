<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Signup - StudioHub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    :root {
      --bg: #0d0d0d;
      --accent: #ff5e1a;
      --accent-2: #ff7f3f;
      --text: #f5f5f5;
      --input-bg: #0f0f0f;
      --card-bg: rgba(20, 20, 20, 0.96);
      --glow: rgba(255, 94, 26, 0.25);
      --google: #ea4335;
      font-family: "Segoe UI", Roboto, system-ui, sans-serif;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: var(--bg);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      position: relative;
      overflow: hidden;
      line-height: 1.6;
    }

    /* Animated Stars */
    .stars {
      position: absolute;
      inset: 0;
      z-index: 0;
      overflow: hidden;
    }
    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      opacity: 0.85;
      animation: twinkle 3.5s infinite ease-in-out;
      filter: drop-shadow(0 0 6px rgba(255, 255, 255, 0.6));
    }
    @keyframes twinkle {
      0%, 100% { opacity: 0.15; transform: scale(0.8); }
      50% { opacity: 1; transform: scale(1.2); }
    }

    /* Card */
    .card {
      position: relative;
      z-index: 1;
      max-width: 440px;
      width: 94%;
      padding: 40px;
      background: var(--card-bg);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow:
        0 20px 50px rgba(0, 0, 0, 0.5),
        0 0 30px var(--glow),
        inset 0 0 20px rgba(255, 94, 26, 0.03);
      text-align: center;
      animation: floatCard 6s ease-in-out infinite;
      transform-style: preserve-3d;
    }
    @keyframes floatCard {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-14px); }
    }

    h1 {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 24px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .input-group {
      position: relative;
      margin: 16px 0;
    }
    input {
      width: 100%;
      padding: 14px 50px 14px 18px;
      border: 0;
      border-radius: 14px;
      background: var(--input-bg);
      color: var(--text);
      font-size: 16px;
      outline: none;
      transition: all 0.25s ease;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
    }
    input:focus {
      box-shadow:
        inset 0 0 0 2px var(--accent),
        0 0 16px var(--glow);
      background: #141414;
    }
    input::placeholder {
      color: #8a8a8a;
      transition: color 0.2s;
    }
    input:focus::placeholder {
      color: #aaa;
    }

    .toggle-pass {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 18px;
      color: #ff7f3f;
      transition: all 0.2s ease;
    }
    .toggle-pass:hover {
      transform: translateY(-50%) scale(1.15);
      color: var(--accent);
    }

    .btn {
      padding: 14px 20px;
      border-radius: 14px;
      font-weight: 700;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s ease;
      border: 0;
      letter-spacing: 0.5px;
      width: 100%;
      margin-top: 20px;
    }
    .btn-primary {
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      color: #fff;
      box-shadow: 0 8px 30px rgba(255, 94, 26, 0.2);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 36px rgba(255, 94, 26, 0.3);
    }
    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 4px 20px rgba(255, 94, 26, 0.25);
    }

    /* Google Icon Only */
    .social-icons {
      margin: 28px 0 20px;
    }
    .google-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: white;
      color: var(--google);
      font-size: 22px;
      cursor: pointer;
      transition: all 0.25s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    .google-icon:hover {
      transform: translateY(-3px) scale(1.08);
      box-shadow: 0 8px 20px rgba(234, 67, 53, 0.3);
    }
    .google-icon:active {
      transform: translateY(0) scale(1);
    }

    .divider-or {
      color: #666;
      font-size: 14px;
      margin: 16px 0;
      letter-spacing: 1px;
      font-weight: 500;
    }

    .link-line {
      margin-top: 24px;
      color: #bdbdbd;
      font-size: 14px;
    }
    .link-line a {
      color: var(--accent-2);
      text-decoration: none;
      font-weight: 700;
      transition: color 0.2s;
    }
    .link-line a:hover {
      color: var(--accent);
      text-decoration: underline;
    }

    /* Alert Toast */
    .alert {
      position: fixed;
      bottom: -80px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 20px;
      border-radius: 12px;
      background: #2e7d32;
      color: #fff;
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.2, 1, 0.2, 1);
      pointer-events: none;
      box-shadow: 0 8px 30px rgba(0, 255, 0, 0.12);
      z-index: 1000;
      font-weight: 500;
    }
    .alert.show {
      opacity: 1;
      bottom: 30px;
    }
    .alert.error {
      background: #d32f2f;
      box-shadow: 0 8px 30px rgba(226, 59, 59, 0.2);
    }

    @media (max-width: 480px) {
      .card {
        padding: 30px 24px;
        border-radius: 16px;
      }
      h1 {
        font-size: 26px;
        margin-bottom: 20px;
      }
      input {
        font-size: 15px;
        padding: 12px 44px 12px 14px;
      }
      .btn {
        padding: 12px 18px;
        font-size: 15px;
      }
      .google-icon {
        width: 44px;
        height: 44px;
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="stars" id="stars"></div>

  <div class="card" role="main" aria-labelledby="signupTitle">
    <h1 id="signupTitle">Create Account</h1>

    <div class="input-group">
      <input id="username" type="text" placeholder="Username" autocomplete="username" aria-label="Username" />
    </div>

    <div class="input-group">
      <input id="password" type="password" placeholder="Password" autocomplete="new-password" aria-label="Password" />
      <i class="fa-solid fa-eye toggle-pass" id="togglePass" title="Show / Hide password" role="button" tabindex="0"></i>
    </div>

    <button class="btn btn-primary" onclick="signup()">Create Account</button>

    <div class="divider-or">or continue with</div>

    <div class="social-icons">
      <div class="google-icon" id="googleIcon" title="Sign up with Google">
        <i class="fab fa-google"></i>
      </div>
    </div>

    <div class="link-line">Already have an account? <a href="login.html">Login</a></div>

    <div class="alert" id="alertBox" role="status" aria-live="polite"></div>
  </div>

  <script>
    // Generate Stars
    const starsContainer = document.getElementById("stars");
    for (let i = 0; i < 100; i++) {
      const s = document.createElement("div");
      s.className = "star";
      s.style.top = Math.random() * 100 + "%";
      s.style.left = Math.random() * 100 + "%";
      const size = 1 + Math.random() * 2.5;
      s.style.width = size + "px";
      s.style.height = size + "px";
      s.style.animationDuration = (2 + Math.random() * 4) + "s";
      s.style.opacity = 0.3 + Math.random() * 0.7;
      starsContainer.appendChild(s);
    }

    // Toggle Password
    const passInput = document.getElementById("password");
    const togglePass = document.getElementById("togglePass");
    togglePass.addEventListener("click", () => {
      if (passInput.type === "password") {
        passInput.type = "text";
        togglePass.classList.replace("fa-eye", "fa-eye-slash");
        togglePass.setAttribute("title", "Hide password");
      } else {
        passInput.type = "password";
        togglePass.classList.replace("fa-eye-slash", "fa-eye");
        togglePass.setAttribute("title", "Show password");
      }
    });

    // Google Sign-In
    let googleInitialized = false;

    function initGoogle() {
      if (!window.google || !window.google.accounts) {
        setTimeout(initGoogle, 200); // Retry until loaded
        return;
      }

      window.google.accounts.id.initialize({
        client_id: "YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com", // ðŸ”¥ REPLACE THIS
        callback: handleGoogleCredentialResponse,
        cancel_on_tap_outside: true,
        prompt_parent_id: null
      });

      googleInitialized = true;
    }

    // Initialize Google when library is ready
    window.onload = initGoogle;

    const googleIcon = document.getElementById("googleIcon");
    googleIcon.addEventListener("click", () => {
      if (!googleInitialized) {
        showAlert("Loading Google...", false);
        setTimeout(() => {
          if (googleInitialized) {
            triggerGoogle();
          } else {
            showAlert("Google services not ready. Try again.", true);
          }
        }, 800);
        return;
      }
      triggerGoogle();
    });

    function triggerGoogle() {
      // Show Google One Tap prompt
      window.google.accounts.id.prompt((notification) => {
        if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
          showAlert("Google sign-in unavailable. Try again later.", true);
        }
      });
    }

    function handleGoogleCredentialResponse(response) {
      if (!response || !response.credential) {
        showAlert("Google sign-in failed", true);
        return;
      }

      const credential = response.credential;
      fetch("/signup-google", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id_token: credential })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          showAlert("Signed up with Google!", false);
          setTimeout(() => window.location.href = "dashboard.html", 1500);
        } else {
          showAlert(data.error || "Google signup failed", true);
        }
      })
      .catch(() => {
        showAlert("Network error during Google signup", true);
      });
    }

    // Traditional Signup
    async function signup() {
      const uname = document.getElementById("username").value.trim();
      const pwd = document.getElementById("password").value.trim();
      if (!uname || !pwd) {
        showAlert("Please fill all fields", true);
        return;
      }

      try {
        const res = await fetch("/signup", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username: uname, password: pwd })
        });
        const data = await res.json();
        if (data.success) {
          showAlert("Account created successfully!", false);
          setTimeout(() => window.location.href = "login.html", 1500);
        } else {
          showAlert(data.error || "Error creating account", true);
        }
      } catch (err) {
        showAlert("Server error. Please try again.", true);
      }
    }

    // Alert System
    function showAlert(msg, isError) {
      const box = document.getElementById("alertBox");
      box.textContent = msg;
      box.className = "alert show" + (isError ? " error" : "");
      setTimeout(() => box.className = "alert", 3000);
    }
  </script>
</body>
</html>